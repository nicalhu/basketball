<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>篮球记分系统</title>
    <link href="https://cdn.staticfile.org/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.staticfile.org/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: "Noto Sans SC", Tahoma, Arial, Roboto, "Droid Sans", "Helvetica Neue", "Droid Sans Fallback", "Heiti SC", "Hiragino Sans GB", Simsun, sans-serif;
        }
        .dark-mode-text {
            @apply text-white;
        }
        .light-mode-text {
            @apply text-gray-800;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-white transition-colors duration-200">
    <div id="app" class="min-h-screen">
        <!-- 导航栏 -->
        <nav class="bg-blue-600 dark:bg-blue-800 text-white p-4 shadow-md">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-basketball-ball text-yellow-400 text-2xl"></i>
                    <span class="text-xl font-bold">篮球记分系统</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="darkModeToggle" class="p-2 rounded-full hover:bg-blue-700 transition-colors">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button id="loginButton" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-md transition-colors">
                        管理员登录
                    </button>
                </div>
            </div>
        </nav>

        <!-- 前端展示部分 -->
        <div id="frontendSection" class="container mx-auto px-4 py-8">
            <!-- 将在这里添加前端展示内容 -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold mb-2">2025赛季篮球联赛</h1>
                <p class="text-lg text-gray-600 dark:text-gray-300">天骄小区篮球联赛</p>
            </div>

            <!-- 广告轮播 -->
            <div class="mb-8 relative overflow-hidden rounded-lg shadow-md">
                <div id="adCarousel" class="carousel-container w-full">
                    <div class="carousel-inner flex transition-transform duration-500 ease-in-out">
                        <!-- 广告将在这里动态加载 -->
                    </div>
                    <button class="carousel-control prev absolute top-1/2 left-4 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="carousel-control next absolute top-1/2 right-4 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <div class="carousel-indicators absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
                        <!-- 指示器将在这里动态加载 -->
                    </div>
                </div>
            </div>

            <!-- 内容区域的容器 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- 左侧边栏 -->
                <div class="md:col-span-1">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                        <h2 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-trophy text-yellow-500 mr-2"></i>
                            球队排行榜
                        </h2>
                        <div id="teamRankings">
                            <!-- 球队排行榜数据将在此显示 -->
                            <p class="text-center text-gray-500 dark:text-gray-400">加载中...</p>
                        </div>
                    </div>
                </div>

                <!-- 中间主区域 -->
                <div class="md:col-span-2">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                        <h2 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-calendar-alt text-blue-500 mr-2"></i>
                            赛程表
                        </h2>
                        <div id="scheduleList">
                            <!-- 赛程表数据将在此显示 -->
                            <p class="text-center text-gray-500 dark:text-gray-400">加载中...</p>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                        <h2 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-chart-line text-green-500 mr-2"></i>
                            得分榜
                        </h2>
                        <div id="scoreBoard">
                            <!-- 得分榜数据将在此显示 -->
                            <p class="text-center text-gray-500 dark:text-gray-400">加载中...</p>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                        <h2 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-trophy text-yellow-500 mr-2"></i>
                            淘汰赛
                        </h2>
                        <div id="playoffBracket" class="overflow-auto">
                            <!-- 淘汰赛对阵图将在此显示 -->
                            <p class="text-center text-gray-500 dark:text-gray-400">加载中...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 管理员登录弹窗 -->
        <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">管理员登录</h2>
                    <button id="closeLoginModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="loginForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 dark:text-gray-300 mb-2" for="username">用户名</label>
                        <input id="username" type="text" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="请输入用户名">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 dark:text-gray-300 mb-2" for="password">密码</label>
                        <input id="password" type="password" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="请输入密码">
                    </div>
                    <div class="mt-6">
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">登录</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 管理员后台部分（默认隐藏） -->
        <div id="adminSection" class="hidden container mx-auto px-4 py-8">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">后台管理系统</h2>
                    <button id="logoutButton" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md transition-colors">
                        退出登录
                    </button>
                </div>
                
                <!-- 管理选项卡 -->
                <div class="border-b border-gray-200 dark:border-gray-700 mb-6">
                    <ul class="flex flex-wrap -mb-px" id="adminTabs" role="tablist">
                        <li class="mr-2" role="presentation">
                            <button class="inline-block p-4 border-b-2 border-blue-600 rounded-t-lg active" id="teams-tab" data-tab-target="teams-content">球队管理</button>
                        </li>
                        <li class="mr-2" role="presentation">
                            <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:border-gray-300" id="players-tab" data-tab-target="players-content">球员管理</button>
                        </li>
                        <li class="mr-2" role="presentation">
                            <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:border-gray-300" id="schedule-tab" data-tab-target="schedule-content">赛程管理</button>
                        </li>
                        <li class="mr-2" role="presentation">
                            <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:border-gray-300" id="playoffs-tab" data-tab-target="playoffs-content">淘汰赛管理</button>
                        </li>
                        <li role="presentation">
                            <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:border-gray-300" id="ads-tab" data-tab-target="ads-content">广告管理</button>
                        </li>
                    </ul>
                </div>
                
                <!-- 标签内容区域 -->
                <div id="adminTabContent">
                    <div class="block" id="teams-content">
                        <h3 class="text-xl font-semibold mb-4">球队管理</h3>
                        <div class="mb-4">
                            <button id="addTeamBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md transition-colors">
                                <i class="fas fa-plus mr-2"></i>添加球队
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white dark:bg-gray-700 rounded-lg overflow-hidden">
                                <thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                                    <tr>
                                        <th class="py-2 px-3 text-left">ID</th>
                                        <th class="py-2 px-3 text-left">队名</th>
                                        <th class="py-2 px-3 text-center">分组</th>
                                        <th class="py-2 px-3 text-center">胜</th>
                                        <th class="py-2 px-3 text-center">负</th>
                                        <th class="py-2 px-3 text-center">积分</th>
                                        <th class="py-2 px-3 text-center">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="teamsTableBody">
                                    <!-- 球队数据将在这里动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="hidden" id="players-content">
                        <h3 class="text-xl font-semibold mb-4">球员管理</h3>
                        <div class="mb-4">
                            <button id="addPlayerBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md transition-colors">
                                <i class="fas fa-plus mr-2"></i>添加球员
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white dark:bg-gray-700 rounded-lg overflow-hidden">
                                <thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                                    <tr>
                                        <th class="py-2 px-3 text-left">ID</th>
                                        <th class="py-2 px-3 text-left">姓名</th>
                                        <th class="py-2 px-3 text-left">球队</th>
                                        <th class="py-2 px-3 text-center">场次</th>
                                        <th class="py-2 px-3 text-center">得分</th>
                                        <th class="py-2 px-3 text-center">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="playersTableBody">
                                    <!-- 球员数据将在这里动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="hidden" id="schedule-content">
                        <h3 class="text-xl font-semibold mb-4">赛程管理</h3>
                        <div class="mb-4">
                            <button id="addScheduleBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md transition-colors">
                                <i class="fas fa-plus mr-2"></i>添加比赛
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white dark:bg-gray-700 rounded-lg overflow-hidden">
                                <thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                                    <tr>
                                        <th class="py-2 px-3 text-left">ID</th>
                                        <th class="py-2 px-3 text-left">日期</th>
                                        <th class="py-2 px-3 text-left">主队</th>
                                        <th class="py-2 px-3 text-left">客队</th>
                                        <th class="py-2 px-3 text-center">比分</th>
                                        <th class="py-2 px-3 text-center">状态</th>
                                        <th class="py-2 px-3 text-center">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="scheduleTableBody">
                                    <!-- 赛程数据将在这里动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="hidden" id="playoffs-content">
                        <h3 class="text-xl font-semibold mb-4">淘汰赛管理</h3>
                        
                        <!-- 半决赛管理 -->
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="text-lg font-medium">半决赛</h4>
                                <button id="addSemiBtn" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-md text-sm transition-colors">
                                    <i class="fas fa-plus mr-1"></i>添加半决赛
                                </button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white dark:bg-gray-700 rounded-lg overflow-hidden">
                                    <thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                                        <tr>
                                            <th class="py-2 px-3 text-left">ID</th>
                                            <th class="py-2 px-3 text-left">日期</th>
                                            <th class="py-2 px-3 text-left">对阵1</th>
                                            <th class="py-2 px-3 text-left">对阵2</th>
                                            <th class="py-2 px-3 text-center">比分</th>
                                            <th class="py-2 px-3 text-center">胜者</th>
                                            <th class="py-2 px-3 text-center">状态</th>
                                            <th class="py-2 px-3 text-center">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="semiFinalsTableBody">
                                        <!-- 半决赛数据将在这里动态加载 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- 决赛管理 -->
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="text-lg font-medium">决赛</h4>
                                <button id="addFinalBtn" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-md text-sm transition-colors">
                                    <i class="fas fa-plus mr-1"></i>添加决赛
                                </button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white dark:bg-gray-700 rounded-lg overflow-hidden">
                                    <thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                                        <tr>
                                            <th class="py-2 px-3 text-left">ID</th>
                                            <th class="py-2 px-3 text-left">日期</th>
                                            <th class="py-2 px-3 text-left">对阵1</th>
                                            <th class="py-2 px-3 text-left">对阵2</th>
                                            <th class="py-2 px-3 text-center">比分</th>
                                            <th class="py-2 px-3 text-center">胜者</th>
                                            <th class="py-2 px-3 text-center">状态</th>
                                            <th class="py-2 px-3 text-center">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="finalsTableBody">
                                        <!-- 决赛数据将在这里动态加载 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="hidden" id="ads-content">
                        <h3 class="text-xl font-semibold mb-4">广告管理</h3>
                        <div class="mb-4">
                            <button id="addAdBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md transition-colors">
                                <i class="fas fa-plus mr-2"></i>添加广告
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="adsContainer">
                            <!-- 广告数据将在这里动态加载 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 球队详情弹窗 -->
        <div id="teamDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold" id="teamModalTitle">球队详情</h2>
                    <button id="closeTeamModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="teamModalContent" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- 球队图片 -->
                    <div class="md:col-span-1">
                        <img id="teamModalImage" src="" alt="球队照片" class="w-full rounded-lg shadow-md">
                    </div>
                    
                    <!-- 球队资料 -->
                    <div class="md:col-span-2">
                        <h3 class="text-lg font-semibold mb-2">球队资料</h3>
                        <div class="space-y-2">
                            <p><span class="font-medium">分组:</span> <span id="teamModalGroup"></span></p>
                            <p><span class="font-medium">战绩:</span> <span id="teamModalRecord"></span></p>
                            <p><span class="font-medium">积分:</span> <span id="teamModalPoints"></span></p>
                        </div>
                        
                        <h3 class="text-lg font-semibold mt-6 mb-2">球员名单</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white dark:bg-gray-700 rounded-lg overflow-hidden">
                                <thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                                    <tr>
                                        <th class="py-2 px-3 text-left">姓名</th>
                                        <th class="py-2 px-3 text-center">场次</th>
                                        <th class="py-2 px-3 text-center">得分</th>
                                        <th class="py-2 px-3 text-center">场均</th>
                                    </tr>
                                </thead>
                                <tbody id="teamModalPlayers">
                                    <!-- 球员数据将在这里显示 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <h3 class="text-lg font-semibold mt-6 mb-2">赛程</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white dark:bg-gray-700 rounded-lg overflow-hidden">
                                <thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                                    <tr>
                                        <th class="py-2 px-3 text-left">日期</th>
                                        <th class="py-2 px-3 text-center">对阵</th>
                                        <th class="py-2 px-3 text-center">比分</th>
                                        <th class="py-2 px-3 text-center">状态</th>
                                    </tr>
                                </thead>
                                <tbody id="teamModalSchedule">
                                    <!-- 赛程数据将在这里显示 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-blue-700 dark:bg-blue-900 text-white py-6">
        <div class="container mx-auto px-4 text-center">
            <p>© 2025 篮球记分系统 - 天骄小区篮球联赛</p>
            <p class="mt-2 text-sm text-blue-200">和睦邻里，和谐社区</p>
        </div>
    </footer>

    <script>
        // 暂存数据（在实际应用中这些数据应该来自后端数据库）
        const appData = {
            teams: [
                { id: 1, name: "北京队", group: "A", wins: 5, losses: 2, points: 12, image: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMTUwIDE1MCIgZmlsbD0ibm9uZSI+PHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNlMmUyZTIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzMzMyI+5YyX5Lqs6ZuGPC90ZXh0Pjwvc3ZnPg==" },
                { id: 2, name: "上海队", group: "A", wins: 6, losses: 1, points: 13, image: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMTUwIDE1MCIgZmlsbD0ibm9uZSI+PHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNlMmUyZTIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzMzMyI+5LiK5rW36ZuGPC90ZXh0Pjwvc3ZnPg==" },
                { id: 3, name: "广州队", group: "B", wins: 4, losses: 3, points: 11, image: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMTUwIDE1MCIgZmlsbD0ibm9uZSI+PHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNlMmUyZTIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzMzMyI+5bm/5bee6ZuGPC90ZXh0Pjwvc3ZnPg==" },
                { id: 4, name: "深圳队", group: "B", wins: 3, losses: 4, points: 10, image: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMTUwIDE1MCIgZmlsbD0ibm9uZSI+PHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNlMmUyZTIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzMzMyI+5rex5Zyz6ZuGPC90ZXh0Pjwvc3ZnPg==" }
            ],
            players: [
                { id: 1, name: "张三", teamId: 1, points: 120, games: 7 },
                { id: 2, name: "李四", teamId: 2, points: 135, games: 7 },
                { id: 3, name: "王五", teamId: 3, points: 98, games: 7 },
                { id: 4, name: "赵六", teamId: 4, points: 110, games: 7 }
            ],
            schedule: [
                { id: 1, date: "2023-10-01", homeTeamId: 1, awayTeamId: 2, homeScore: 88, awayScore: 76, status: "completed" },
                { id: 2, date: "2023-10-05", homeTeamId: 3, awayTeamId: 4, homeScore: 92, awayScore: 85, status: "completed" },
                { id: 3, date: "2023-10-10", homeTeamId: 1, awayTeamId: 3, homeScore: null, awayScore: null, status: "scheduled" },
                { id: 4, date: "2023-10-15", homeTeamId: 2, awayTeamId: 4, homeScore: null, awayScore: null, status: "scheduled" }
            ],
            ads: [
                { id: 1, title: "篮球鞋促销", image: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgODAwIDIwMCIgZmlsbD0ibm9uZSI+PHJlY3Qgd2lkdGg9IjgwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlMmUyZTIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIzNiIgZmlsbD0iIzMzMyI+56+A55CD6ZiF5L6L5LygPC90ZXh0Pjwvc3ZnPg==", link: "#" },
                { id: 2, title: "新款球衣上市", image: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgODAwIDIwMCIgZmlsbD0ibm9uZSI+PHJlY3Qgd2lkdGg9IjgwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlMmUyZTIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIzNiIgZmlsbD0iIzMzMyI+5paw5qy+55CD6KGM5LiK5biCPC90ZXh0Pjwvc3ZnPg==", link: "#" }
            ],
            playoffs: [
                { 
                    id: 1, 
                    round: "semi", 
                    matchNumber: 1, 
                    team1Id: 2, 
                    team2Id: 3, 
                    team1Score: 105, 
                    team2Score: 98, 
                    winner: 2, 
                    date: "2023-11-01", 
                    status: "completed" 
                },
                { 
                    id: 2, 
                    round: "semi", 
                    matchNumber: 2, 
                    team1Id: 1, 
                    team2Id: 4, 
                    team1Score: 110, 
                    team2Score: 92, 
                    winner: 1, 
                    date: "2023-11-02", 
                    status: "completed" 
                },
                { 
                    id: 3, 
                    round: "final", 
                    matchNumber: 1, 
                    team1Id: 2, 
                    team2Id: 1, 
                    team1Score: null, 
                    team2Score: null, 
                    winner: null, 
                    date: "2023-11-10", 
                    status: "scheduled" 
                }
            ]
        };
        
        // 从localStorage加载数据
        function loadData() {
            const savedData = localStorage.getItem('basketballAppData');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                
                // 合并数据，确保新字段不会丢失
                if (parsedData.teams) appData.teams = parsedData.teams;
                if (parsedData.players) appData.players = parsedData.players;
                if (parsedData.schedule) appData.schedule = parsedData.schedule;
                if (parsedData.ads) appData.ads = parsedData.ads;
                if (parsedData.playoffs) appData.playoffs = parsedData.playoffs;
                
                console.log('已从localStorage加载数据');
            }
        }
        
        // 保存数据到localStorage
        function saveData() {
            try {
                localStorage.setItem('basketballAppData', JSON.stringify(appData));
                console.log('已保存数据到localStorage');
            } catch (e) {
                console.error('保存数据失败:', e);
                alert('保存数据失败，可能是因为数据量太大。建议减少广告图片的大小或数量。');
            }
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 加载保存的数据
            loadData();
            
            // 初始化深色模式
            initDarkMode();
            
            // 初始化前端展示数据
            renderTeamRankings();
            renderSchedule();
            renderScoreBoard();
            renderAdCarousel();
            renderPlayoffBracket();
            
            // 设置登录弹窗和后台管理的事件监听
            setupLoginSystem();
            
            // 设置后台管理选项卡
            setupAdminTabs();
            
            // 初始化后台管理数据
            initAdminData();
            
            // 设置后台管理相关事件
            setupAdminEvents();
            
            // 设置球队详情弹窗
            setupTeamDetailModal();
        });

        // 深色模式切换功能
        function initDarkMode() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
            }
            
            darkModeToggle.addEventListener('click', function() {
                document.documentElement.classList.toggle('dark');
                updateDarkModeIcon();
            });
            
            updateDarkModeIcon();
            
            function updateDarkModeIcon() {
                const icon = darkModeToggle.querySelector('i');
                if (document.documentElement.classList.contains('dark')) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                }
            }
        }

        // 登录系统功能
        function setupLoginSystem() {
            const loginButton = document.getElementById('loginButton');
            const loginModal = document.getElementById('loginModal');
            const closeLoginModal = document.getElementById('closeLoginModal');
            const loginForm = document.getElementById('loginForm');
            const logoutButton = document.getElementById('logoutButton');
            const frontendSection = document.getElementById('frontendSection');
            const adminSection = document.getElementById('adminSection');
            
            // 打开登录弹窗
            loginButton.addEventListener('click', function() {
                loginModal.classList.remove('hidden');
            });
            
            // 关闭登录弹窗
            closeLoginModal.addEventListener('click', function() {
                loginModal.classList.add('hidden');
            });
            
            // 登录表单提交
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                if (username === 'admin' && password === 'admin') {
                    // 登录成功
                    loginModal.classList.add('hidden');
                    frontendSection.classList.add('hidden');
                    adminSection.classList.remove('hidden');
                    loginButton.classList.add('hidden');
                } else {
                    alert('用户名或密码不正确！');
                }
            });
            
            // 登出
            logoutButton.addEventListener('click', function() {
                adminSection.classList.add('hidden');
                frontendSection.classList.remove('hidden');
                loginButton.classList.remove('hidden');
            });
        }

        // 后台管理选项卡功能
        function setupAdminTabs() {
            const tabButtons = document.querySelectorAll('[data-tab-target]');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // 移除所有选项卡的活动状态
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active', 'border-blue-600');
                        btn.classList.add('border-transparent');
                    });
                    
                    // 隐藏所有内容区域
                    document.querySelectorAll('#adminTabContent > div').forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // 激活当前选项卡
                    this.classList.add('active', 'border-blue-600');
                    this.classList.remove('border-transparent');
                    
                    // 显示对应的内容区域
                    const targetId = this.getAttribute('data-tab-target');
                    document.getElementById(targetId).classList.remove('hidden');
                });
            });
        }

        // 初始化后台管理数据
        function initAdminData() {
            renderTeamsTable();
            renderPlayersTable();
            renderScheduleTable();
            renderAdsContainer();
            renderPlayoffsTable();
        }
        
        // 设置后台管理相关事件
        function setupAdminEvents() {
            // 添加球队按钮事件
            document.getElementById('addTeamBtn').addEventListener('click', function() {
                const newTeamId = Math.max(...appData.teams.map(team => team.id), 0) + 1;
                appData.teams.push({
                    id: newTeamId,
                    name: "新球队",
                    group: "A",
                    wins: 0,
                    losses: 0,
                    points: 0,
                    image: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMTUwIDE1MCIgZmlsbD0ibm9uZSI+PHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNlMmUyZTIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzMzMyI+5paw55CD6ZuGPC90ZXh0Pjwvc3ZnPg=="
                });
                renderTeamsTable();
                updateFrontendContent(); // 更新前端展示并保存数据
                alert('已添加新球队，请编辑详细信息');
            });
            
            // 添加球员按钮事件
            document.getElementById('addPlayerBtn').addEventListener('click', function() {
                const newPlayerId = Math.max(...appData.players.map(player => player.id), 0) + 1;
                appData.players.push({
                    id: newPlayerId,
                    name: "新球员",
                    teamId: appData.teams.length > 0 ? appData.teams[0].id : 0,
                    points: 0,
                    games: 0
                });
                renderPlayersTable();
                updateFrontendContent(); // 更新前端展示并保存数据
                alert('已添加新球员，请编辑详细信息');
            });
            
            // 添加比赛按钮事件
            document.getElementById('addScheduleBtn').addEventListener('click', function() {
                const newScheduleId = Math.max(...appData.schedule.map(match => match.id), 0) + 1;
                const today = new Date().toISOString().split('T')[0];
                appData.schedule.push({
                    id: newScheduleId,
                    date: today,
                    homeTeamId: appData.teams.length > 0 ? appData.teams[0].id : 0,
                    awayTeamId: appData.teams.length > 1 ? appData.teams[1].id : 0,
                    homeScore: null,
                    awayScore: null,
                    status: "scheduled"
                });
                renderScheduleTable();
                updateFrontendContent(); // 更新前端展示并保存数据
                alert('已添加新比赛，请编辑详细信息');
            });
            
            // 添加广告按钮事件
            document.getElementById('addAdBtn').addEventListener('click', function() {
                const newAdId = Math.max(...appData.ads.map(ad => ad.id), 0) + 1;
                appData.ads.push({
                    id: newAdId,
                    title: "新广告",
                    image: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgODAwIDIwMCIgZmlsbD0ibm9uZSI+PHJlY3Qgd2lkdGg9IjgwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlMmUyZTIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIzNiIgZmlsbD0iIzMzMyI+5paw5bm/5ZGKIjwvdGV4dD48L3N2Zz4=",
                    link: ""  // 默认为空字符串，表示没有链接
                });
                renderAdsContainer();
                updateFrontendContent(); // 更新前端展示并保存数据
                editAd(newAdId);
            });
            
            // 添加半决赛按钮事件
            document.getElementById('addSemiBtn').addEventListener('click', function() {
                const newPlayoffId = Math.max(...appData.playoffs.map(match => match.id), 0) + 1;
                const today = new Date().toISOString().split('T')[0];
                
                appData.playoffs.push({
                    id: newPlayoffId,
                    round: "semi",
                    matchNumber: appData.playoffs.filter(match => match.round === "semi").length + 1,
                    team1Id: appData.teams.length > 0 ? appData.teams[0].id : 0,
                    team2Id: appData.teams.length > 1 ? appData.teams[1].id : 0,
                    team1Score: null,
                    team2Score: null,
                    winner: null,
                    date: today,
                    status: "scheduled"
                });
                
                renderPlayoffsTable();
                updateFrontendContent(); // 更新前端展示并保存数据
                editPlayoff(newPlayoffId);
            });
            
            // 添加决赛按钮事件
            document.getElementById('addFinalBtn').addEventListener('click', function() {
                // 检查是否已有决赛
                const existingFinal = appData.playoffs.find(match => match.round === "final");
                if (existingFinal) {
                    alert('已存在决赛，请编辑现有决赛');
                    return;
                }
                
                const newPlayoffId = Math.max(...appData.playoffs.map(match => match.id), 0) + 1;
                const today = new Date().toISOString().split('T')[0];
                
                // 获取半决赛的胜者作为决赛的参赛队伍
                const semiFinals = appData.playoffs.filter(match => match.round === "semi" && match.status === "completed");
                const team1Id = semiFinals.length > 0 && semiFinals[0].winner ? semiFinals[0].winner : (appData.teams.length > 0 ? appData.teams[0].id : 0);
                const team2Id = semiFinals.length > 1 && semiFinals[1].winner ? semiFinals[1].winner : (appData.teams.length > 1 ? appData.teams[1].id : 0);
                
                appData.playoffs.push({
                    id: newPlayoffId,
                    round: "final",
                    matchNumber: 1,
                    team1Id: team1Id,
                    team2Id: team2Id,
                    team1Score: null,
                    team2Score: null,
                    winner: null,
                    date: today,
                    status: "scheduled"
                });
                
                renderPlayoffsTable();
                updateFrontendContent(); // 更新前端展示并保存数据
                editPlayoff(newPlayoffId);
            });
            
            // 添加清除数据按钮事件
            const logoutButton = document.getElementById('logoutButton');
            const clearDataButton = document.createElement('button');
            clearDataButton.id = 'clearDataButton';
            clearDataButton.className = 'bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-md transition-colors ml-2';
            clearDataButton.innerHTML = '清除数据';
            clearDataButton.addEventListener('click', clearStorageData);
            
            // 在退出登录按钮旁添加清除数据按钮
            logoutButton.parentNode.insertBefore(clearDataButton, logoutButton.nextSibling);
        }
        
        // 渲染球队表格
        function renderTeamsTable() {
            const teamsTableBody = document.getElementById('teamsTableBody');
            let html = '';
            
            appData.teams.forEach(team => {
                html += `<tr class="border-t border-gray-200 dark:border-gray-600">
                    <td class="py-2 px-3">${team.id}</td>
                    <td class="py-2 px-3">${team.name}</td>
                    <td class="py-2 px-3 text-center">${team.group}</td>
                    <td class="py-2 px-3 text-center">${team.wins}</td>
                    <td class="py-2 px-3 text-center">${team.losses}</td>
                    <td class="py-2 px-3 text-center">${team.points}</td>
                    <td class="py-2 px-3 text-center">
                        <button class="text-blue-500 hover:text-blue-700 mx-1" onclick="editTeam(${team.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-500 hover:text-red-700 mx-1" onclick="deleteTeam(${team.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>`;
            });
            
            teamsTableBody.innerHTML = html;
        }
        
        // 编辑球队
        function editTeam(teamId) {
            const team = appData.teams.find(t => t.id === teamId);
            if (!team) return;
            
            const newName = prompt('输入球队名称:', team.name);
            if (newName !== null) {
                team.name = newName;
            }
            
            const newGroup = prompt('输入分组 (A 或 B):', team.group);
            if (newGroup !== null) {
                team.group = newGroup.toUpperCase();
            }
            
            const newWins = prompt('输入胜场数:', team.wins);
            if (newWins !== null) {
                team.wins = parseInt(newWins);
                // 更新积分
                team.points = team.wins * 2 + team.losses;
            }
            
            const newLosses = prompt('输入负场数:', team.losses);
            if (newLosses !== null) {
                team.losses = parseInt(newLosses);
                // 更新积分
                team.points = team.wins * 2 + team.losses;
            }
            
            renderTeamsTable();
            renderTeamRankings();
            renderSchedule();
            renderPlayoffBracket(); // 更新淘汰赛展示
            saveData(); // 保存数据
        }
        
        // 删除球队
        function deleteTeam(teamId) {
            if (confirm('确定要删除这个球队吗？')) {
                const index = appData.teams.findIndex(t => t.id === teamId);
                if (index !== -1) {
                    appData.teams.splice(index, 1);
                    renderTeamsTable();
                    renderTeamRankings();
                    renderSchedule();
                    renderPlayoffBracket(); // 更新淘汰赛展示
                }
            }
            saveData(); // 保存数据
        }
        
        // 渲染球员表格
        function renderPlayersTable() {
            const playersTableBody = document.getElementById('playersTableBody');
            let html = '';
            
            appData.players.forEach(player => {
                const team = appData.teams.find(t => t.id === player.teamId);
                html += `<tr class="border-t border-gray-200 dark:border-gray-600">
                    <td class="py-2 px-3">${player.id}</td>
                    <td class="py-2 px-3">${player.name}</td>
                    <td class="py-2 px-3">${team ? team.name : '未分配'}</td>
                    <td class="py-2 px-3 text-center">${player.games}</td>
                    <td class="py-2 px-3 text-center">${player.points}</td>
                    <td class="py-2 px-3 text-center">
                        <button class="text-blue-500 hover:text-blue-700 mx-1" onclick="editPlayer(${player.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-500 hover:text-red-700 mx-1" onclick="deletePlayer(${player.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>`;
            });
            
            playersTableBody.innerHTML = html;
        }
        
        // 编辑球员
        function editPlayer(playerId) {
            const player = appData.players.find(p => p.id === playerId);
            if (!player) return;
            
            const newName = prompt('输入球员姓名:', player.name);
            if (newName !== null) {
                player.name = newName;
            }
            
            let teamOptions = '';
            appData.teams.forEach(team => {
                teamOptions += `${team.id}: ${team.name}\n`;
            });
            
            const newTeamId = prompt(`选择球队ID:\n${teamOptions}`, player.teamId);
            if (newTeamId !== null) {
                player.teamId = parseInt(newTeamId);
            }
            
            const newGames = prompt('输入比赛场次:', player.games);
            if (newGames !== null) {
                player.games = parseInt(newGames);
            }
            
            const newPoints = prompt('输入总得分:', player.points);
            if (newPoints !== null) {
                player.points = parseInt(newPoints);
            }
            
            renderPlayersTable();
            renderScoreBoard();
            // 更新球队详情中的球员列表（如果当前正在查看该球员所属的球队）
            const teamDetailModal = document.getElementById('teamDetailModal');
            if (teamDetailModal && !teamDetailModal.classList.contains('hidden')) {
                const teamId = parseInt(teamDetailModal.getAttribute('data-team-id'));
                if (teamId === player.teamId) {
                    renderTeamPlayers(teamId);
                }
            }
            saveData(); // 保存数据
        }
        
        // 删除球员
        function deletePlayer(playerId) {
            if (confirm('确定要删除这个球员吗？')) {
                const index = appData.players.findIndex(p => p.id === playerId);
                if (index !== -1) {
                    const player = appData.players[index];
                    const teamId = player.teamId;
                    appData.players.splice(index, 1);
                    renderPlayersTable();
                    renderScoreBoard();
                    // 更新球队详情中的球员列表（如果当前正在查看该球员所属的球队）
                    const teamDetailModal = document.getElementById('teamDetailModal');
                    if (teamDetailModal && !teamDetailModal.classList.contains('hidden')) {
                        const currentTeamId = parseInt(teamDetailModal.getAttribute('data-team-id'));
                        if (currentTeamId === teamId) {
                            renderTeamPlayers(teamId);
                        }
                    }
                }
            }
            saveData(); // 保存数据
        }
        
        // 渲染赛程表格
        function renderScheduleTable() {
            const scheduleTableBody = document.getElementById('scheduleTableBody');
            let html = '';
            
            appData.schedule.forEach(match => {
                const homeTeam = appData.teams.find(t => t.id === match.homeTeamId);
                const awayTeam = appData.teams.find(t => t.id === match.awayTeamId);
                let scoreDisplay = '未开始';
                
                if (match.status === 'completed') {
                    scoreDisplay = `${match.homeScore} : ${match.awayScore}`;
                }
                
                html += `<tr class="border-t border-gray-200 dark:border-gray-600">
                    <td class="py-2 px-3">${match.id}</td>
                    <td class="py-2 px-3">${match.date}</td>
                    <td class="py-2 px-3">${homeTeam ? homeTeam.name : '未知'}</td>
                    <td class="py-2 px-3">${awayTeam ? awayTeam.name : '未知'}</td>
                    <td class="py-2 px-3 text-center">${scoreDisplay}</td>
                    <td class="py-2 px-3 text-center">${match.status === 'completed' ? '已结束' : '未开始'}</td>
                    <td class="py-2 px-3 text-center">
                        <button class="text-blue-500 hover:text-blue-700 mx-1" onclick="editSchedule(${match.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-500 hover:text-red-700 mx-1" onclick="deleteSchedule(${match.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>`;
            });
            
            scheduleTableBody.innerHTML = html;
        }
        
        // 编辑赛程
        function editSchedule(scheduleId) {
            const match = appData.schedule.find(s => s.id === scheduleId);
            if (!match) return;
            
            const newDate = prompt('输入比赛日期 (YYYY-MM-DD):', match.date);
            if (newDate !== null) {
                match.date = newDate;
            }
            
            let teamOptions = '';
            appData.teams.forEach(team => {
                teamOptions += `${team.id}: ${team.name}\n`;
            });
            
            const newHomeTeamId = prompt(`选择主队ID:\n${teamOptions}`, match.homeTeamId);
            if (newHomeTeamId !== null) {
                match.homeTeamId = parseInt(newHomeTeamId);
            }
            
            const newAwayTeamId = prompt(`选择客队ID:\n${teamOptions}`, match.awayTeamId);
            if (newAwayTeamId !== null) {
                match.awayTeamId = parseInt(newAwayTeamId);
            }
            
            const statusOptions = "scheduled: 未开始\ncompleted: 已结束";
            const newStatus = prompt(`选择比赛状态:\n${statusOptions}`, match.status);
            if (newStatus !== null) {
                match.status = newStatus;
            }
            
            if (match.status === 'completed') {
                const newHomeScore = prompt('输入主队得分:', match.homeScore || 0);
                if (newHomeScore !== null) {
                    match.homeScore = parseInt(newHomeScore);
                }
                
                const newAwayScore = prompt('输入客队得分:', match.awayScore || 0);
                if (newAwayScore !== null) {
                    match.awayScore = parseInt(newAwayScore);
                }
            }
            
            renderScheduleTable();
            renderSchedule();
            
            // 更新球队详情中的赛程信息
            const teamDetailModal = document.getElementById('teamDetailModal');
            if (teamDetailModal && !teamDetailModal.classList.contains('hidden')) {
                const teamId = parseInt(teamDetailModal.getAttribute('data-team-id'));
                if (teamId === match.homeTeamId || teamId === match.awayTeamId) {
                    renderTeamSchedule(teamId);
                }
            }
            saveData(); // 保存数据
        }
        
        // 删除赛程
        function deleteSchedule(scheduleId) {
            if (confirm('确定要删除这场比赛吗？')) {
                const index = appData.schedule.findIndex(s => s.id === scheduleId);
                if (index !== -1) {
                    const match = appData.schedule[index];
                    const homeTeamId = match.homeTeamId;
                    const awayTeamId = match.awayTeamId;
                    appData.schedule.splice(index, 1);
                    renderScheduleTable();
                    renderSchedule();
                    
                    // 更新球队详情中的赛程信息
                    const teamDetailModal = document.getElementById('teamDetailModal');
                    if (teamDetailModal && !teamDetailModal.classList.contains('hidden')) {
                        const teamId = parseInt(teamDetailModal.getAttribute('data-team-id'));
                        if (teamId === homeTeamId || teamId === awayTeamId) {
                            renderTeamSchedule(teamId);
                        }
                    }
                }
            }
            saveData(); // 保存数据
        }
        
        // 渲染广告容器
        function renderAdsContainer() {
            const adsContainer = document.getElementById('adsContainer');
            let html = '';
            
            appData.ads.forEach(ad => {
                const linkText = ad.link ? ad.link : '无链接';
                // 添加删除按钮，用于单独删除广告
                html += `<div class="bg-white dark:bg-gray-700 rounded-lg overflow-hidden shadow-md">
                    <img src="${ad.image}" alt="${ad.title}" class="w-full h-32 object-cover">
                    <div class="p-4">
                        <h4 class="font-semibold mb-2">${ad.title}</h4>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">链接: ${linkText}</p>
                        <div class="flex justify-end">
                            <button class="text-blue-500 hover:text-blue-700 mx-1" onclick="editAd(${ad.id})">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button class="text-red-500 hover:text-red-700 mx-1" onclick="deleteAd(${ad.id})">
                                <i class="fas fa-trash"></i> 删除
                            </button>
                        </div>
                    </div>
                </div>`;
            });
            
            adsContainer.innerHTML = html;
        }
        
        // 编辑广告
        function editAd(adId) {
            const ad = appData.ads.find(a => a.id === adId);
            if (!ad) return;
            
            // 先删除可能存在的旧模态框
            const existingModal = document.getElementById('adEditModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // 创建一个模态框进行广告编辑
            const modalDiv = document.createElement('div');
            modalDiv.id = 'adEditModal';
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modalDiv.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">编辑广告</h2>
                        <button id="closeAdEditModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <form id="adEditForm" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2" for="adTitle">广告标题</label>
                            <input id="adTitle" type="text" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="${ad.title}">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2" for="adLink">
                                广告链接 <span class="text-gray-500 text-sm">(可选)</span>
                            </label>
                            <input id="adLink" type="text" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="${ad.link || ''}">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">广告图片</label>
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0">
                                    <img id="adImagePreview" src="${ad.image}" alt="广告预览" class="w-24 h-24 object-cover border rounded-md">
                                </div>
                                <div class="flex-grow">
                                    <div class="relative">
                                        <input id="adImageUpload" type="file" accept="image/*" class="opacity-0 absolute inset-0 w-full h-full cursor-pointer">
                                        <button type="button" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-md transition-colors">
                                            选择图片
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                                        支持 JPG、PNG 格式<br>
                                        图片将自动压缩以节省空间
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-end mt-6">
                            <button type="submit" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-md transition-colors">
                                保存广告
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            // 添加模态框到文档
            document.body.appendChild(modalDiv);
            
            // 获取DOM元素 - 确保在添加到DOM之后再获取
            const adEditModal = document.getElementById('adEditModal');
            const closeAdEditModal = document.getElementById('closeAdEditModal');
            const adEditForm = document.getElementById('adEditForm');
            const adImageUpload = document.getElementById('adImageUpload');
            const adImagePreview = document.getElementById('adImagePreview');
            
            if (!adEditModal || !closeAdEditModal || !adEditForm) {
                console.error('无法找到广告编辑模态框的元素');
                return;
            }
            
            // 确保图片上传元素存在
            if (adImageUpload && adImagePreview) {
                // 图片上传预览
                adImageUpload.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            // 图片加载后，先进行压缩
                            compressImage(e.target.result, 800, 600, 0.7)
                                .then(compressedImage => {
                                    adImagePreview.src = compressedImage;
                                });
                        };
                        reader.readAsDataURL(file);
                    }
                });
            } else {
                console.error('无法找到图片上传元素');
            }
            
            // 关闭模态框
            closeAdEditModal.addEventListener('click', function() {
                adEditModal.remove();
            });
            
            // 表单提交
            adEditForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const titleInput = document.getElementById('adTitle');
                const linkInput = document.getElementById('adLink');
                
                if (titleInput) {
                    ad.title = titleInput.value;
                    // 链接是可选的，如果为空设置为空字符串
                    ad.link = linkInput && linkInput.value ? linkInput.value : '';
                    
                    // 如果有图片上传，更新图片
                    if (adImagePreview && adImagePreview.src !== ad.image) {
                        ad.image = adImagePreview.src;
                    }
                    
                    renderAdsContainer();
                    updateFrontendContent(); // 更新前端展示并保存数据
                }
                
                adEditModal.remove();
            });
        }
        
        // 删除广告
        function deleteAd(adId) {
            if (confirm('确定要删除这个广告吗？')) {
                const index = appData.ads.findIndex(a => a.id === adId);
                if (index !== -1) {
                    appData.ads.splice(index, 1);
                    renderAdsContainer();
                    updateFrontendContent(); // 更新前端展示并保存数据
                }
            }
        }

        // 渲染球队排行榜
        function renderTeamRankings() {
            const teamRankings = document.getElementById('teamRankings');
            const groupA = appData.teams.filter(team => team.group === "A");
            const groupB = appData.teams.filter(team => team.group === "B");
            
            let html = '<div class="mb-4">';
            html += '<h3 class="font-bold mb-2">A组排名</h3>';
            html += '<div class="overflow-x-auto">';
            html += '<table class="min-w-full bg-white dark:bg-gray-700 rounded-lg overflow-hidden">';
            html += '<thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">';
            html += '<tr><th class="py-2 px-3 text-left">排名</th><th class="py-2 px-3 text-left">队名</th><th class="py-2 px-3 text-center">战绩</th><th class="py-2 px-3 text-center">积分</th></tr>';
            html += '</thead><tbody>';
            
            // 按积分排序
            groupA.sort((a, b) => b.points - a.points);
            
            groupA.forEach((team, index) => {
                html += `<tr class="border-t border-gray-200 dark:border-gray-600">
                    <td class="py-2 px-3">${index + 1}</td>
                    <td class="py-2 px-3"><a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="showTeamDetail(${team.id}); return false;">${team.name}</a></td>
                    <td class="py-2 px-3 text-center">${team.wins}胜${team.losses}负</td>
                    <td class="py-2 px-3 text-center">${team.points}</td>
                </tr>`;
            });
            
            html += '</tbody></table></div></div>';
            
            html += '<div>';
            html += '<h3 class="font-bold mb-2">B组排名</h3>';
            html += '<div class="overflow-x-auto">';
            html += '<table class="min-w-full bg-white dark:bg-gray-700 rounded-lg overflow-hidden">';
            html += '<thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">';
            html += '<tr><th class="py-2 px-3 text-left">排名</th><th class="py-2 px-3 text-left">队名</th><th class="py-2 px-3 text-center">战绩</th><th class="py-2 px-3 text-center">积分</th></tr>';
            html += '</thead><tbody>';
            
            // 按积分排序
            groupB.sort((a, b) => b.points - a.points);
            
            groupB.forEach((team, index) => {
                html += `<tr class="border-t border-gray-200 dark:border-gray-600">
                    <td class="py-2 px-3">${index + 1}</td>
                    <td class="py-2 px-3"><a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="showTeamDetail(${team.id}); return false;">${team.name}</a></td>
                    <td class="py-2 px-3 text-center">${team.wins}胜${team.losses}负</td>
                    <td class="py-2 px-3 text-center">${team.points}</td>
                </tr>`;
            });
            
            html += '</tbody></table></div></div>';
            
            teamRankings.innerHTML = html;
        }

        // 渲染赛程表
        function renderSchedule() {
            const scheduleList = document.getElementById('scheduleList');
            let html = '<div class="overflow-x-auto">';
            html += '<table class="min-w-full bg-white dark:bg-gray-700 rounded-lg overflow-hidden">';
            html += '<thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">';
            html += '<tr><th class="py-2 px-3 text-left">日期</th><th class="py-2 px-3 text-right">主队</th><th class="py-2 px-3 text-center">比分</th><th class="py-2 px-3 text-left">客队</th><th class="py-2 px-3 text-center">状态</th></tr>';
            html += '</thead><tbody>';
            
            appData.schedule.forEach(match => {
                const homeTeam = appData.teams.find(team => team.id === match.homeTeamId);
                const awayTeam = appData.teams.find(team => team.id === match.awayTeamId);
                const matchDate = new Date(match.date).toLocaleDateString('zh-CN');
                let scoreDisplay = '-';
                let statusClass = '';
                let statusText = '未开始';
                
                if (match.status === 'completed') {
                    scoreDisplay = `${match.homeScore} : ${match.awayScore}`;
                    statusClass = 'bg-gray-200 dark:bg-gray-600';
                    statusText = '已结束';
                }
                
                html += `<tr class="border-t border-gray-200 dark:border-gray-600 ${statusClass}">
                    <td class="py-2 px-3">${matchDate}</td>
                    <td class="py-2 px-3 text-right font-medium"><a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="showTeamDetail(${homeTeam.id}); return false;">${homeTeam.name}</a></td>
                    <td class="py-2 px-3 text-center font-bold">${scoreDisplay}</td>
                    <td class="py-2 px-3 text-left font-medium"><a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="showTeamDetail(${awayTeam.id}); return false;">${awayTeam.name}</a></td>
                    <td class="py-2 px-3 text-center text-sm text-gray-500 dark:text-gray-400">${statusText}</td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            
            scheduleList.innerHTML = html;
        }

        // 渲染得分榜
        function renderScoreBoard() {
            const scoreBoard = document.getElementById('scoreBoard');
            
            // 按得分排序
            const sortedPlayers = [...appData.players].sort((a, b) => b.points - a.points);
            
            let html = '<div class="overflow-x-auto">';
            html += '<table class="min-w-full bg-white dark:bg-gray-700 rounded-lg overflow-hidden">';
            html += '<thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">';
            html += '<tr><th class="py-2 px-3 text-left">排名</th><th class="py-2 px-3 text-left">球员</th><th class="py-2 px-3 text-left">球队</th><th class="py-2 px-3 text-center">场次</th><th class="py-2 px-3 text-center">总得分</th><th class="py-2 px-3 text-center">场均</th></tr>';
            html += '</thead><tbody>';
            
            sortedPlayers.forEach((player, index) => {
                const team = appData.teams.find(team => team.id === player.teamId);
                const avgPoints = (player.points / player.games).toFixed(1);
                
                html += `<tr class="border-t border-gray-200 dark:border-gray-600">
                    <td class="py-2 px-3">${index + 1}</td>
                    <td class="py-2 px-3 font-medium">${player.name}</td>
                    <td class="py-2 px-3">${team.name}</td>
                    <td class="py-2 px-3 text-center">${player.games}</td>
                    <td class="py-2 px-3 text-center font-bold">${player.points}</td>
                    <td class="py-2 px-3 text-center">${avgPoints}</td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            
            scoreBoard.innerHTML = html;
        }

        // 渲染广告轮播
        function renderAdCarousel() {
            const carouselInner = document.querySelector('#adCarousel .carousel-inner');
            const carouselIndicators = document.querySelector('#adCarousel .carousel-indicators');
            let innerHtml = '';
            let indicatorsHtml = '';
            
            appData.ads.forEach((ad, index) => {
                const linkStart = ad.link && ad.link !== '#' ? `<a href="${ad.link}" target="_blank">` : '<div>';
                const linkEnd = ad.link && ad.link !== '#' ? '</a>' : '</div>';
                
                innerHtml += `
                    <div class="carousel-item min-w-full ${index === 0 ? 'active' : ''}">
                        ${linkStart}
                            <img src="${ad.image}" alt="${ad.title}" class="w-full h-48 md:h-64 object-cover">
                            <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-2">
                                <p class="text-center">${ad.title}</p>
                            </div>
                        ${linkEnd}
                    </div>
                `;
                
                indicatorsHtml += `
                    <button class="carousel-indicator-btn w-3 h-3 rounded-full bg-white bg-opacity-50 ${index === 0 ? 'bg-opacity-100' : ''}" data-index="${index}"></button>
                `;
            });
            
            carouselInner.innerHTML = innerHtml;
            carouselIndicators.innerHTML = indicatorsHtml;
            
            // 设置轮播功能
            setupCarousel();
        }
        
        // 设置轮播功能
        function setupCarousel() {
            const carouselContainer = document.getElementById('adCarousel');
            const carouselInner = carouselContainer.querySelector('.carousel-inner');
            const prevBtn = carouselContainer.querySelector('.carousel-control.prev');
            const nextBtn = carouselContainer.querySelector('.carousel-control.next');
            const indicatorBtns = carouselContainer.querySelectorAll('.carousel-indicator-btn');
            const items = carouselContainer.querySelectorAll('.carousel-item');
            
            let currentIndex = 0;
            const itemCount = items.length;
            
            if (itemCount <= 1) {
                // 如果只有一个或没有广告，隐藏控制按钮
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
                return;
            }
            
            // 自动轮播定时器
            let autoSlideInterval = setInterval(nextSlide, 5000);
            
            // 上一张
            prevBtn.addEventListener('click', function() {
                clearInterval(autoSlideInterval);
                currentIndex = (currentIndex - 1 + itemCount) % itemCount;
                updateCarousel();
                autoSlideInterval = setInterval(nextSlide, 5000);
            });
            
            // 下一张
            nextBtn.addEventListener('click', function() {
                clearInterval(autoSlideInterval);
                nextSlide();
                autoSlideInterval = setInterval(nextSlide, 5000);
            });
            
            // 指示器点击
            indicatorBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    clearInterval(autoSlideInterval);
                    currentIndex = parseInt(this.getAttribute('data-index'));
                    updateCarousel();
                    autoSlideInterval = setInterval(nextSlide, 5000);
                });
            });
            
            function nextSlide() {
                currentIndex = (currentIndex + 1) % itemCount;
                updateCarousel();
            }
            
            function updateCarousel() {
                // 更新轮播位置
                carouselInner.style.transform = `translateX(-${currentIndex * 100}%)`;
                
                // 更新指示器状态
                indicatorBtns.forEach((btn, index) => {
                    if (index === currentIndex) {
                        btn.classList.add('bg-opacity-100');
                        btn.classList.remove('bg-opacity-50');
                    } else {
                        btn.classList.remove('bg-opacity-100');
                        btn.classList.add('bg-opacity-50');
                    }
                });
            }
        }

        // 设置球队详情弹窗
        function setupTeamDetailModal() {
            const teamDetailModal = document.getElementById('teamDetailModal');
            const closeTeamModal = document.getElementById('closeTeamModal');
            
            // 关闭弹窗
            closeTeamModal.addEventListener('click', function() {
                teamDetailModal.classList.add('hidden');
            });
            
            // 点击弹窗外部区域关闭
            teamDetailModal.addEventListener('click', function(e) {
                if (e.target === teamDetailModal) {
                    teamDetailModal.classList.add('hidden');
                }
            });
        }
        
        // 显示球队详情
        function showTeamDetail(teamId) {
            const team = appData.teams.find(t => t.id === teamId);
            if (!team) return;
            
            // 更新弹窗标题和内容
            document.getElementById('teamModalTitle').textContent = team.name;
            document.getElementById('teamModalImage').src = team.image;
            document.getElementById('teamModalImage').alt = team.name;
            document.getElementById('teamModalGroup').textContent = team.group + '组';
            document.getElementById('teamModalRecord').textContent = team.wins + '胜' + team.losses + '负';
            document.getElementById('teamModalPoints').textContent = team.points;
            
            // 保存当前查看的球队ID，用于实时更新
            const teamDetailModal = document.getElementById('teamDetailModal');
            teamDetailModal.setAttribute('data-team-id', teamId);
            
            // 更新球员列表
            renderTeamPlayers(teamId);
            
            // 更新赛程
            renderTeamSchedule(teamId);
            
            // 显示弹窗
            teamDetailModal.classList.remove('hidden');
        }
        
        // 渲染球队球员列表
        function renderTeamPlayers(teamId) {
            const teamPlayers = appData.players.filter(player => player.teamId === teamId);
            const teamPlayersElement = document.getElementById('teamModalPlayers');
            let html = '';
            
            if (teamPlayers.length === 0) {
                html = '<tr><td colspan="4" class="py-4 text-center text-gray-500">暂无球员数据</td></tr>';
            } else {
                // 按得分排序
                teamPlayers.sort((a, b) => b.points - a.points);
                
                teamPlayers.forEach(player => {
                    const avgPoints = player.games > 0 ? (player.points / player.games).toFixed(1) : '0.0';
                    html += `<tr class="border-t border-gray-200 dark:border-gray-600">
                        <td class="py-2 px-3 font-medium">${player.name}</td>
                        <td class="py-2 px-3 text-center">${player.games}</td>
                        <td class="py-2 px-3 text-center">${player.points}</td>
                        <td class="py-2 px-3 text-center">${avgPoints}</td>
                    </tr>`;
                });
            }
            
            teamPlayersElement.innerHTML = html;
        }
        
        // 渲染球队赛程
        function renderTeamSchedule(teamId) {
            const teamSchedule = appData.schedule.filter(match => 
                match.homeTeamId === teamId || match.awayTeamId === teamId
            );
            const teamScheduleElement = document.getElementById('teamModalSchedule');
            let html = '';
            
            if (teamSchedule.length === 0) {
                html = '<tr><td colspan="4" class="py-4 text-center text-gray-500">暂无赛程数据</td></tr>';
            } else {
                // 按日期排序
                teamSchedule.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                teamSchedule.forEach(match => {
                    const homeTeam = appData.teams.find(t => t.id === match.homeTeamId);
                    const awayTeam = appData.teams.find(t => t.id === match.awayTeamId);
                    const matchDate = new Date(match.date).toLocaleDateString('zh-CN');
                    const isHome = match.homeTeamId === teamId;
                    let opponent = isHome ? awayTeam.name : homeTeam.name;
                    let scoreDisplay = '-';
                    let statusText = '未开始';
                    
                    if (match.status === 'completed') {
                        if (isHome) {
                            scoreDisplay = `${match.homeScore} : ${match.awayScore}`;
                        } else {
                            scoreDisplay = `${match.awayScore} : ${match.homeScore}`;
                        }
                        statusText = '已结束';
                    }
                    
                    let matchType = isHome ? '主场' : '客场';
                    let opponentDisplay = isHome ? `vs ${opponent}` : `@ ${opponent}`;
                    
                    html += `<tr class="border-t border-gray-200 dark:border-gray-600">
                        <td class="py-2 px-3">${matchDate}</td>
                        <td class="py-2 px-3 text-center">
                            <span class="inline-block px-2 py-1 text-xs rounded ${isHome ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'}">${matchType}</span>
                            ${opponentDisplay}
                        </td>
                        <td class="py-2 px-3 text-center font-bold">${scoreDisplay}</td>
                        <td class="py-2 px-3 text-center text-sm">${statusText}</td>
                    </tr>`;
                });
            }
            
            teamScheduleElement.innerHTML = html;
        }

        // 渲染淘汰赛对阵图
        function renderPlayoffBracket() {
            const playoffBracket = document.getElementById('playoffBracket');
            
            // 获取半决赛和决赛数据
            const semiFinals = appData.playoffs.filter(match => match.round === "semi");
            const finals = appData.playoffs.filter(match => match.round === "final");
            
            let html = `
                <div class="flex flex-col md:flex-row justify-center items-center space-y-6 md:space-y-0 md:space-x-6 p-4">
                    <!-- 半决赛 -->
                    <div class="bracket-round">
                        <h3 class="text-center font-semibold mb-4">半决赛</h3>
                        <div class="space-y-6">
            `;
            
            semiFinals.forEach(match => {
                const team1 = appData.teams.find(t => t.id === match.team1Id);
                const team2 = appData.teams.find(t => t.id === match.team2Id);
                const matchDate = new Date(match.date).toLocaleDateString('zh-CN');
                let scoreDisplay = match.status === 'completed' ? `${match.team1Score} - ${match.team2Score}` : 'vs';
                let team1Class = match.winner === match.team1Id ? 'bg-green-100 dark:bg-green-900 font-bold' : '';
                let team2Class = match.winner === match.team2Id ? 'bg-green-100 dark:bg-green-900 font-bold' : '';
                
                html += `
                    <div class="bracket-match bg-white dark:bg-gray-700 rounded-lg shadow p-3 w-64">
                        <div class="text-xs text-gray-600 dark:text-gray-400 mb-2">${matchDate}</div>
                        <div class="bracket-teams space-y-2">
                            <div class="bracket-team p-2 rounded ${team1Class} flex justify-between items-center">
                                <a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="showTeamDetail(${team1.id}); return false;">${team1.name}</a>
                                <span>${match.status === 'completed' ? match.team1Score : ''}</span>
                            </div>
                            <div class="bracket-team p-2 rounded ${team2Class} flex justify-between items-center">
                                <a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="showTeamDetail(${team2.id}); return false;">${team2.name}</a>
                                <span>${match.status === 'completed' ? match.team2Score : ''}</span>
                            </div>
                        </div>
                        <div class="text-center mt-2 text-sm">${match.status === 'completed' ? '已结束' : '未开始'}</div>
                    </div>
                `;
            });
            
            html += `
                        </div>
                    </div>
                    
                    <!-- 连接线 -->
                    <div class="hidden md:flex flex-col justify-center items-center">
                        <div class="h-24 border-r-2 border-gray-300 dark:border-gray-600"></div>
                        <div class="w-6 border-t-2 border-gray-300 dark:border-gray-600"></div>
                        <div class="h-24 border-r-2 border-gray-300 dark:border-gray-600"></div>
                    </div>
                    
                    <!-- 决赛 -->
                    <div class="bracket-round">
                        <h3 class="text-center font-semibold mb-4">决赛</h3>
            `;
            
            if (finals.length > 0) {
                const final = finals[0];
                const team1 = appData.teams.find(t => t.id === final.team1Id);
                const team2 = appData.teams.find(t => t.id === final.team2Id);
                const matchDate = new Date(final.date).toLocaleDateString('zh-CN');
                let scoreDisplay = final.status === 'completed' ? `${final.team1Score} - ${final.team2Score}` : 'vs';
                let team1Class = final.winner === final.team1Id ? 'bg-green-100 dark:bg-green-900 font-bold' : '';
                let team2Class = final.winner === final.team2Id ? 'bg-green-100 dark:bg-green-900 font-bold' : '';
                
                html += `
                    <div class="bracket-match bg-white dark:bg-gray-700 rounded-lg shadow p-3 w-64">
                        <div class="text-xs text-gray-600 dark:text-gray-400 mb-2">${matchDate}</div>
                        <div class="bracket-teams space-y-2">
                            <div class="bracket-team p-2 rounded ${team1Class} flex justify-between items-center">
                                <a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="showTeamDetail(${team1.id}); return false;">${team1.name}</a>
                                <span>${final.status === 'completed' ? final.team1Score : ''}</span>
                            </div>
                            <div class="bracket-team p-2 rounded ${team2Class} flex justify-between items-center">
                                <a href="#" class="text-blue-600 dark:text-blue-400 hover:underline" onclick="showTeamDetail(${team2.id}); return false;">${team2.name}</a>
                                <span>${final.status === 'completed' ? final.team2Score : ''}</span>
                            </div>
                        </div>
                        <div class="text-center mt-2 text-sm">${final.status === 'completed' ? '已结束' : '未开始'}</div>
                    </div>
                `;
            } else {
                html += `
                    <div class="bracket-match bg-white dark:bg-gray-700 rounded-lg shadow p-3 w-64">
                        <div class="text-center py-4 text-gray-500">决赛未安排</div>
                    </div>
                `;
            }
            
            html += `
                    </div>
                    
                    <!-- 冠军 -->
                    <div class="hidden md:flex flex-col justify-center items-center">
                        <div class="h-24 border-r-2 border-gray-300 dark:border-gray-600"></div>
                        <div class="w-6 border-t-2 border-gray-300 dark:border-gray-600"></div>
                        <div class="h-24 border-r-2 border-gray-300 dark:border-gray-600"></div>
                    </div>
                    
                    <div class="bracket-round">
                        <h3 class="text-center font-semibold mb-4">冠军</h3>
            `;
            
            // 检查是否有冠军
            const champion = finals.length > 0 && finals[0].status === 'completed' ? 
                appData.teams.find(t => t.id === finals[0].winner) : null;
                
            if (champion) {
                html += `
                    <div class="bracket-champion bg-yellow-100 dark:bg-yellow-900 rounded-lg shadow p-4 w-48 text-center">
                        <div class="text-xl font-bold mb-2">${champion.name}</div>
                        <a href="#" onclick="showTeamDetail(${champion.id}); return false;">
                            <img src="${champion.image}" alt="${champion.name}" class="w-full h-32 object-cover rounded-lg">
                        </a>
                        <div class="mt-2 text-sm text-yellow-800 dark:text-yellow-200">
                            <i class="fas fa-crown text-yellow-500 mr-1"></i> 冠军
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div class="bracket-champion bg-gray-100 dark:bg-gray-700 rounded-lg shadow p-4 w-48 text-center">
                        <div class="py-6 text-gray-500">待定</div>
                    </div>
                `;
            }
            
            html += `
                    </div>
                </div>
            `;
            
            playoffBracket.innerHTML = html;
        }

        // 渲染淘汰赛表格
        function renderPlayoffsTable() {
            // 渲染半决赛表格
            const semiFinalsTableBody = document.getElementById('semiFinalsTableBody');
            const semiFinals = appData.playoffs.filter(match => match.round === "semi");
            let semiHtml = '';
            
            if (semiFinals.length === 0) {
                semiHtml = '<tr><td colspan="8" class="py-4 text-center text-gray-500">暂无半决赛数据</td></tr>';
            } else {
                semiFinals.forEach(match => {
                    const team1 = appData.teams.find(t => t.id === match.team1Id);
                    const team2 = appData.teams.find(t => t.id === match.team2Id);
                    const matchDate = new Date(match.date).toLocaleDateString('zh-CN');
                    let scoreDisplay = match.status === 'completed' ? `${match.team1Score} : ${match.team2Score}` : '-';
                    
                    let winnerDisplay = '-';
                    if (match.status === 'completed' && match.winner) {
                        const winnerTeam = appData.teams.find(t => t.id === match.winner);
                        winnerDisplay = winnerTeam ? winnerTeam.name : '-';
                    }
                    
                    semiHtml += `<tr class="border-t border-gray-200 dark:border-gray-600">
                        <td class="py-2 px-3">${match.id}</td>
                        <td class="py-2 px-3">${matchDate}</td>
                        <td class="py-2 px-3">${team1 ? team1.name : '未选择'}</td>
                        <td class="py-2 px-3">${team2 ? team2.name : '未选择'}</td>
                        <td class="py-2 px-3 text-center">${scoreDisplay}</td>
                        <td class="py-2 px-3 text-center">${winnerDisplay}</td>
                        <td class="py-2 px-3 text-center">${match.status === 'completed' ? '已结束' : '未开始'}</td>
                        <td class="py-2 px-3 text-center">
                            <button class="text-blue-500 hover:text-blue-700 mx-1" onclick="editPlayoff(${match.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-700 mx-1" onclick="deletePlayoff(${match.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
                });
            }
            
            semiFinalsTableBody.innerHTML = semiHtml;
            
            // 渲染决赛表格
            const finalsTableBody = document.getElementById('finalsTableBody');
            const finals = appData.playoffs.filter(match => match.round === "final");
            let finalHtml = '';
            
            if (finals.length === 0) {
                finalHtml = '<tr><td colspan="8" class="py-4 text-center text-gray-500">暂无决赛数据</td></tr>';
            } else {
                finals.forEach(match => {
                    const team1 = appData.teams.find(t => t.id === match.team1Id);
                    const team2 = appData.teams.find(t => t.id === match.team2Id);
                    const matchDate = new Date(match.date).toLocaleDateString('zh-CN');
                    let scoreDisplay = match.status === 'completed' ? `${match.team1Score} : ${match.team2Score}` : '-';
                    
                    let winnerDisplay = '-';
                    if (match.status === 'completed' && match.winner) {
                        const winnerTeam = appData.teams.find(t => t.id === match.winner);
                        winnerDisplay = winnerTeam ? winnerTeam.name : '-';
                    }
                    
                    finalHtml += `<tr class="border-t border-gray-200 dark:border-gray-600">
                        <td class="py-2 px-3">${match.id}</td>
                        <td class="py-2 px-3">${matchDate}</td>
                        <td class="py-2 px-3">${team1 ? team1.name : '未选择'}</td>
                        <td class="py-2 px-3">${team2 ? team2.name : '未选择'}</td>
                        <td class="py-2 px-3 text-center">${scoreDisplay}</td>
                        <td class="py-2 px-3 text-center">${winnerDisplay}</td>
                        <td class="py-2 px-3 text-center">${match.status === 'completed' ? '已结束' : '未开始'}</td>
                        <td class="py-2 px-3 text-center">
                            <button class="text-blue-500 hover:text-blue-700 mx-1" onclick="editPlayoff(${match.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-700 mx-1" onclick="deletePlayoff(${match.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
                });
            }
            
            finalsTableBody.innerHTML = finalHtml;
        }
        
        // 编辑淘汰赛
        function editPlayoff(playoffId) {
            const match = appData.playoffs.find(m => m.id === playoffId);
            if (!match) return;
            
            // 创建一个模态框进行淘汰赛编辑
            const modalDiv = document.createElement('div');
            modalDiv.id = 'playoffEditModal';
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modalDiv.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">编辑${match.round === 'semi' ? '半决赛' : '决赛'}</h2>
                        <button id="closePlayoffEditModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <form id="playoffEditForm" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2" for="playoffDate">比赛日期</label>
                            <input id="playoffDate" type="date" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="${match.date}">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2" for="team1Select">对阵队伍1</label>
                            <select id="team1Select" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                ${appData.teams.map(team => `<option value="${team.id}" ${team.id === match.team1Id ? 'selected' : ''}>${team.name}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2" for="team2Select">对阵队伍2</label>
                            <select id="team2Select" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                ${appData.teams.map(team => `<option value="${team.id}" ${team.id === match.team2Id ? 'selected' : ''}>${team.name}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2" for="statusSelect">比赛状态</label>
                            <select id="statusSelect" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="scheduled" ${match.status === 'scheduled' ? 'selected' : ''}>未开始</option>
                                <option value="completed" ${match.status === 'completed' ? 'selected' : ''}>已结束</option>
                            </select>
                        </div>
                        <div id="scoreSection" class="${match.status === 'completed' ? '' : 'hidden'}">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="team1Score">队伍1得分</label>
                                    <input id="team1Score" type="number" min="0" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="${match.team1Score || 0}">
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="team2Score">队伍2得分</label>
                                    <input id="team2Score" type="number" min="0" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="${match.team2Score || 0}">
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-gray-700 dark:text-gray-300 mb-2" for="winnerSelect">胜者</label>
                                <select id="winnerSelect" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="">-- 选择胜者 --</option>
                                    <option value="${match.team1Id}" ${match.winner === match.team1Id ? 'selected' : ''}>队伍1</option>
                                    <option value="${match.team2Id}" ${match.winner === match.team2Id ? 'selected' : ''}>队伍2</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-end mt-6">
                            <button type="submit" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-md transition-colors">
                                保存
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            // 添加模态框到文档
            document.body.appendChild(modalDiv);
            
            const playoffEditModal = document.getElementById('playoffEditModal');
            const closePlayoffEditModal = document.getElementById('closePlayoffEditModal');
            const playoffEditForm = document.getElementById('playoffEditForm');
            const statusSelect = document.getElementById('statusSelect');
            const scoreSection = document.getElementById('scoreSection');
            
            // 状态变化时显示/隐藏得分区域
            statusSelect.addEventListener('change', function() {
                if (this.value === 'completed') {
                    scoreSection.classList.remove('hidden');
                } else {
                    scoreSection.classList.add('hidden');
                }
            });
            
            // 关闭模态框
            closePlayoffEditModal.addEventListener('click', function() {
                playoffEditModal.remove();
            });
            
            // 表单提交
            playoffEditForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                match.date = document.getElementById('playoffDate').value;
                match.team1Id = parseInt(document.getElementById('team1Select').value);
                match.team2Id = parseInt(document.getElementById('team2Select').value);
                match.status = document.getElementById('statusSelect').value;
                
                if (match.status === 'completed') {
                    match.team1Score = parseInt(document.getElementById('team1Score').value);
                    match.team2Score = parseInt(document.getElementById('team2Score').value);
                    match.winner = document.getElementById('winnerSelect').value ? parseInt(document.getElementById('winnerSelect').value) : null;
                } else {
                    match.team1Score = null;
                    match.team2Score = null;
                    match.winner = null;
                }
                
                renderPlayoffsTable();
                updateFrontendContent(); // 更新前端展示并保存数据
                playoffEditModal.remove();
                
                // 如果这是半决赛且已完成，更新决赛的队伍
                if (match.round === 'semi' && match.status === 'completed' && match.winner) {
                    const final = appData.playoffs.find(m => m.round === 'final');
                    if (final) {
                        // 确定这是第几场半决赛
                        const semiIndex = appData.playoffs.filter(m => m.round === 'semi').findIndex(m => m.id === match.id);
                        
                        if (semiIndex === 0) {
                            final.team1Id = match.winner;
                        } else if (semiIndex === 1) {
                            final.team2Id = match.winner;
                        }
                        
                        renderPlayoffsTable();
                        updateFrontendContent(); // 更新前端展示并保存数据
                    }
                }
            });
        }
        
        // 删除淘汰赛
        function deletePlayoff(playoffId) {
            if (confirm('确定要删除这场淘汰赛吗？')) {
                const index = appData.playoffs.findIndex(m => m.id === playoffId);
                if (index !== -1) {
                    const match = appData.playoffs[index];
                    appData.playoffs.splice(index, 1);
                    
                    // 如果删除的是半决赛且获胜者已进入决赛，更新决赛数据
                    if (match.round === 'semi' && match.status === 'completed' && match.winner) {
                        const final = appData.playoffs.find(m => m.round === 'final');
                        if (final) {
                            if (final.team1Id === match.winner) {
                                final.team1Id = null;
                            } else if (final.team2Id === match.winner) {
                                final.team2Id = null;
                            }
                        }
                    }
                    
                    renderPlayoffsTable();
                    updateFrontendContent(); // 更新前端展示并保存数据
                }
            }
        }

        // 添加一个全局更新前端内容的函数
        function updateFrontendContent() {
            // 更新前端所有展示区域
            renderTeamRankings();
            renderSchedule();
            renderScoreBoard();
            renderAdCarousel();
            renderPlayoffBracket();
            
            // 如果球队详情弹窗正在显示，也更新它
            const teamDetailModal = document.getElementById('teamDetailModal');
            if (teamDetailModal && !teamDetailModal.classList.contains('hidden')) {
                const teamId = parseInt(teamDetailModal.getAttribute('data-team-id'));
                if (teamId) {
                    renderTeamPlayers(teamId);
                    renderTeamSchedule(teamId);
                }
            }
            
            // 保存数据到localStorage
            saveData();
        }

        // 压缩图片尺寸和质量
        function compressImage(dataURL, maxWidth, maxHeight, quality) {
            return new Promise((resolve) => {
                const img = new Image();
                img.src = dataURL;
                img.onload = function() {
                    let width = img.width;
                    let height = img.height;
                    
                    // 计算缩放比例
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    if (height > maxHeight) {
                        width = (width * maxHeight) / height;
                        height = maxHeight;
                    }
                    
                    // 创建canvas并绘制压缩后的图像
                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // 转换为dataURL
                    const compressedDataURL = canvas.toDataURL('image/jpeg', quality);
                    resolve(compressedDataURL);
                };
            });
        }

        // 清理localStorage中的数据
        function clearStorageData() {
            if (confirm('确定要清除所有保存的数据吗？这将重置应用到初始状态。')) {
                localStorage.removeItem('basketballAppData');
                alert('数据已清除，将刷新页面以应用更改。');
                location.reload();
            }
        }
    </script>
</body>
</html> 